<html>
	<head>
		<script src="js/mail-generator.js"></script>
		<title>GeeMail Challenge</title>
		<link href="css/style.css" rel="stylesheet" media="screen">
    <script>
      window.onload = function(){
        // ALL OF YOUR JAVASCRIPT CODE SHOULD GO HERE. 
        // We have to use window.onload so your JavaScript doesn't execute until the page has loaded and all HTML has been downloaded to your browser
       
        var headerDiv = document.createElement('div');
        headerDiv.className = "heading";
        var header = document.createElement('h1');
        var headerSpan = document.createElement('span');
        headerSpan.id = "header";
        var headerText = document.createTextNode("GeeMail Account");
        header.appendChild(headerText);
        headerSpan.appendChild(header);
        headerDiv.appendChild(headerSpan);
        document.body.appendChild(headerSpan);
        document.body.appendChild(headerDiv);
        
        var emailIconDiv = document.createElement('div');
        emailIconDiv.id = "iconDiv";
        var emailIcon = document.createElement('img');
        emailIcon.src = "assets/emailmeme.jpg";
        emailIcon.id = "emailIcon";
        emailIconDiv.appendChild(emailIcon);
        headerDiv.appendChild(emailIconDiv);


        var inboxDiv = document.createElement('div');
        inboxDiv.id = "inbox";
        var inboxText = document.createTextNode("Inbox: ");
        inboxSpan = document.createElement('span');
        inboxSpan.id = "count";
        inboxSpan.appendChild(inboxText);
        inboxDiv.appendChild(inboxSpan);
        document.body.appendChild(inboxDiv);

        var mainWrap = document.createElement('div');
        mainWrap.id = "mainWrap";

        function newEmail(mail){
        	for (var i=0; i < mail.length; i++){
        		console.log(mail[i]);
        		var sender = mail[i].sender;
        		var subject = mail[i].subject;
        		var date = mail[i].date;
        		var body = mail[i].body;

        		var emailContainer = document.createElement('div');
        		emailContainer.className ="email";
        		mainWrap.appendChild(emailContainer);
                document.body.appendChild(mainWrap);
       		
        		var senderName = document.createElement('div');
        		senderName.className = "sender";
        		senderName.innerHTML = sender;
        		emailContainer.appendChild(senderName);

        		var subjectLine = document.createElement('div');
        		subjectLine.className = "subject";
        		subjectLine.innerHTML = subject;
        		emailContainer.appendChild(subjectLine);

                var dateStamp = document.createElement('div');
                dateStamp.className = "date";
                dateStamp.innerHTML = date;
                emailContainer.appendChild(dateStamp);

        		var bodyText = document.createElement('div');
        		bodyText.className = "body";
        		bodyText.innerHTML = body;
        		emailContainer.appendChild(bodyText);

        //Event Listener below
        var expandEmail = document.getElementsByClassName('email');
        for (var j = 0; j < expandEmail.length; j++){
            expandEmail[j].addEventListener('click', showMessage);
        }
        function showMessage(event){
            var showBody = this.querySelectorAll('.body')[0]; //'this' refers to the expandEmail[j] variable or the Div with the class name 'main'. .body to get all elements with class = body in the CSS file. THIS refers to elements (showBodyText). Function will go through all indexes starting with [0].
            if (showBody.classList.contains('show')===false){ //Refer to the CSS file. Will add or remove show to display the body message.
                return showBody.classList.add('show');
            } else {
                return showBody.classList.remove('show');
            }

        } //closes showMessage function

            } //closes for loop for newEmail function
                    
        } //closes newEmail function
        newEmail(geemails);

        //Inbox counter
        var inboxCount = document.getElementById('count');
        inboxCount = geemails.length; //want the length of geemails counted
        var totalCount = document.createTextNode(inboxCount); 
        count.appendChild(totalCount); //append the total count to the inbox span

        //Function for setInterval and to increment new messages
        function youveGotMail(){
            var newMessage = getNewMessage();
            console.log(getNewMessage());
            console.log(getNewMessage().sender);
            console.log(getNewMessage().subject);
            console.log(getNewMessage().date);
            console.log(getNewMessage().body);  

            var emailContainer = document.createElement('div');
                emailContainer.className ="email";
                mainWrap.appendChild(emailContainer);
                document.body.appendChild(mainWrap);
            
            var senderName = document.createElement('div');
                senderName.className = "sender";
                senderName.innerHTML = newMessage.sender;
                emailContainer.appendChild(senderName);

            var subjectLine = document.createElement('div');
                subjectLine.className = "subject";
                subjectLine.innerHTML = newMessage.subject;
                emailContainer.appendChild(subjectLine);

            var dateStamp = document.createElement('div');
                dateStamp.className = "date";
                dateStamp.innerHTML = newMessage.date;
                emailContainer.appendChild(dateStamp);

            var bodyText = document.createElement('div');
                bodyText.className = "body";
                bodyText.innerHTML = newMessage.body;
                emailContainer.appendChild(bodyText);

            //inbox count
            inboxCount++;
            count.innerHTML = "Inbox: " + inboxCount;
                         
            //Event Listener for added messages
            var expandEmail = document.getElementsByClassName('email');

                for (var j = 0; j < expandEmail.length; j++){
                expandEmail[j].addEventListener('click', showMessage);
                }
            function showMessage(event){
                var showBody = this.querySelectorAll('.body')[0]; //'this' refers to the expandEmail[j] variable or the Div with the class name 'main'.
                if (showBody.classList.contains('show')===false){
                    return showBody.classList.add('show');
                } else {
                    return showBody.classList.remove('show');
                } //closes return showBody remove show
            } //closes function for showMessage
                
        } //closes function for youveGotMail
        setInterval(youveGotMail, 2000);

        }; //windows onload
       
    </script>
	</head>
	<body>
    		
	</body>
</html>